<%- include("../partials/head") %>
<style>
/* ====== RESET ====== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background-color: #f8f9fa;
    color: #333;
}

/* ====== CAROUSEL ====== */
.carousel-container {
    position: relative;
    max-width: 1200px;
    margin: 40px auto;
    overflow: hidden;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}
.carousel {
    display: flex;
    transition: transform 0.5s ease;
}
.carousel-slide {
    min-width: 100%;
    height: 500px;
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    text-align: center;
    position: relative;
}
.carousel-slide::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.3);
}
.carousel-content {
    position: relative;
    z-index: 2;
}
.carousel-content h2 {
    font-size: 48px;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}
.carousel-content p {
    font-size: 20px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}
.carousel-indicators {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    z-index: 10;
    pointer-events: none;
}
.indicator {
    pointer-events: auto;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
    cursor: pointer;
    transition: all 0.3s;
}
.indicator.active {
    background: #fff;
    transform: scale(1.2);
}

/* ====== PRODUCT SECTIONS ====== */
.products-section {
    max-width: 1200px;
    margin: 60px auto;
    padding: 0 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding: 0 10px;
}

.section-header h2 {
    font-size: 32px;
    font-weight: bold;
    color: #333;
    margin: 0;
}

.view-all-btn {
    background: none;
    border: none;
    color: #b50b0b;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.view-all-btn:hover {
    background-color: #f8f9fa;
    text-decoration: none;
    color: #b50b0b;
}

/* ====== PRODUCT CARDS ====== */
.product-card {
    transition: all 0.3s ease;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    background: #fff;
    border: none;
    height: 100%;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.product-image-container {
    position: relative;
    overflow: hidden;
    height: 250px;
}

.product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
    cursor: pointer;
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

.product-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #dc3545;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    z-index: 2;
}

/* ====== WISHLIST ICON ====== */
.wishlist-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 35px;
    height: 35px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 3;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.wishlist-icon:hover {
    background: rgba(255, 255, 255, 1);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.wishlist-icon i {
    font-size: 16px;
    color: #666;
    transition: all 0.3s ease;
}

.wishlist-icon:hover i {
    color: #dc3545;
    transform: scale(1.1);
}

.wishlist-icon.active i {
    color: #dc3545;
}

.product-info {
    padding: 15px;
}

.product-brand {
    color: #6c757d;
    font-size: 13px;
    margin-bottom: 5px;
    text-transform: uppercase;
}

.product-title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin-bottom: 10px;
    line-height: 1.4;
    height: 2.8em;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
}

.product-price {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    margin-bottom: 0;
}

.price-section {
    display: flex;
    align-items: center;
    gap: 8px;
}

.current-price {
    font-size: 18px;
    font-weight: bold;
    color: #333;
}

.original-price {
    font-size: 14px;
    color: #6c757d;
    text-decoration: line-through;
}

.add-to-cart {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 9999px;
    background-color: #000;
    color: #fff;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    cursor: pointer;
    flex-shrink: 0;
}

.add-to-cart:hover {
    background-color: #333;
    color: #fff;
    transform: scale(1.1);
}

.add-to-cart:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
    transform: none;
}

/* ====== LOADING STATES ====== */
.loading-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 300px;
}

.spinner-border {
    width: 3rem;
    height: 3rem;
}

.no-products {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.no-products i {
    font-size: 48px;
    margin-bottom: 20px;
    opacity: 0.5;
}

/* ====== WHY CHOOSE SECTION ====== */
.why-choose {
    background: #fff;
    padding: 80px 20px;
    margin: 60px 0;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
}
.why-choose h2 {
    text-align: center;
    font-size: 42px;
    margin-bottom: 60px;
    color: #333;
}
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 40px;
    max-width: 1000px;
    margin: 0 auto;
}
.feature-card {
    text-align: center;
    padding: 30px 20px;
    background: #f8f9fa;
    border-radius: 15px;
    transition: all 0.3s;
}
.feature-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}
.feature-icon {
    font-size: 48px;
    margin-bottom: 20px;
}
.feature-title {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 15px;
    color: #333;
}
.feature-description {
    color: #666;
    line-height: 1.6;
}

/* ====== RESPONSIVE ====== */
@media (max-width: 768px) {
    .carousel-slide { height: 300px; }
    .carousel-content h2 { font-size: 32px; }
    .products-section { padding: 0 10px; margin: 40px auto; }
    .section-header h2 { font-size: 24px; }
    .why-choose { padding: 60px 10px; margin: 40px 0; }
    .features-grid { grid-template-columns: 1fr; }
    .why-choose h2 { font-size: 32px; margin-bottom: 30px; }
}

@media (max-width: 480px) {
    .carousel-slide { height: 200px; }
    .carousel-content h2 { font-size: 20px; }
    .carousel-content p { font-size: 14px; }
    .section-header h2 { font-size: 20px; }
    .why-choose { padding: 40px 10px; margin: 20px 0; }
    .why-choose h2 { font-size: 22px; }
    .product-image-container { height: 200px; }
}
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Static Carousel Banner -->
<div class="carousel-container">
    <div class="carousel" id="carousel">
        <!-- Slide 1 -->
        <div class="carousel-slide" style="background-image: url('/images/banner1.jpg')">
            <div class="carousel-content">
                <h2>Limited Edition Cars</h2>
                <p>Discover exclusive miniature masterpieces that capture automotive excellence.</p>
            </div>
        </div>
        
        <!-- Slide 2 -->
        <div class="carousel-slide" style="background-image: url('/images/banner2.jpg')">
            <div class="carousel-content">
                <h2>Premium Detailing</h2>
                <p>Every diecast model showcases incredible attention to detail and craftsmanship.</p>
            </div>
        </div>
        
        <!-- Slide 3 -->
        <div class="carousel-slide" style="background-image: url('/images/banner3.jpg')">
            <div class="carousel-content">
                <h2>Collector's Paradise</h2>
                <p>Build your dream collection with authentic scaled automotive art.</p>
            </div>
        </div>
    </div>
    
    <!-- Static Indicators -->
    <div class="carousel-indicators">
        <div class="indicator active" data-slide="0"></div>
        <div class="indicator" data-slide="1"></div>
        <div class="indicator" data-slide="2"></div>
    </div>
</div>

<!-- Flash Sales Section -->
<section class="products-section">
    <div class="section-header">
        <h2><i class="fa-brands fa-pied-piper-hat fa-sm" style="color: #dc3545; margin-right: 10px;"></i>Flash Sales</h2>
        <button class="view-all-btn" onclick="viewAllProducts()">
            <i class="fas fa-arrow-right me-2"></i>View All
        </button>
    </div>

    <!-- Loading State -->
    <div id="flashSalesLoading" class="loading-container">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading products...</span>
        </div>
    </div>

    <!-- Products Grid -->
    <div id="flashSalesGrid" class="row g-4" style="display: none;">
        <!-- Products will be loaded here -->
    </div>

    <!-- No Products Message -->
    <div id="flashSalesEmpty" class="no-products" style="display: none;">
        <i class="fas fa-box-open"></i>
        <h4>No Flash Sale Products</h4>
        <p>Check back later for amazing deals!</p>
    </div>
</section>

<!-- New Arrivals Section -->
<section class="products-section">
    <div class="section-header">
        <h2><i class="fa-brands fa-pied-piper-hat fa-sm" style="color: #dc3545; margin-right: 10px;"></i>New Arrivals</h2>
        <button class="view-all-btn" onclick="viewAllProducts()">
            <i class="fas fa-arrow-right me-2"></i>View All
        </button>
    </div>

    <!-- Loading State -->
    <div id="newArrivalsLoading" class="loading-container">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading products...</span>
        </div>
    </div>

    <!-- Products Grid -->
    <div id="newArrivalsGrid" class="row g-4" style="display: none;">
        <!-- Products will be loaded here -->
    </div>

    <!-- No Products Message -->
    <div id="newArrivalsEmpty" class="no-products" style="display: none;">
        <i class="fas fa-star"></i>
        <h4>No New Arrivals</h4>
        <p>New products will appear here soon!</p>
    </div>
</section>

<!-- Why Choose Section -->
<section class="why-choose" id="about">
    <h2>Why Choose miniTorque?</h2>
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon"><i class="fa-solid fa-face-grin-stars fa-shake"></i></div>
            <h3 class="feature-title">Premium Quality</h3>
            <p class="feature-description">Exceptional attention to detail with authentic paint schemes and precise engineering.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon"><i class="fa-solid fa-car-burst fa-bounce"></i></div>
            <h3 class="feature-title">Rare Collectibles</h3>
            <p class="feature-description">Access exclusive limited editions from prestigious automotive brands.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon"><i class="fa-solid fa-truck-fast fa-flip"></i></div>
            <h3 class="feature-title">Secure Shipping</h3>
            <p class="feature-description">Carefully packaged and delivered safely with full insurance coverage.</p>
        </div>
    </div>
</section>

<!-- Footer -->
<%- include("../partials/footer") %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
//  Initialize userWishlistIds safely
const serverWishlistIds = <%- JSON.stringify(userWishlistIds || []) %>;

// ====== PAGE INITIALIZATION ======
document.addEventListener('DOMContentLoaded', async function() {
    // Initialize cart state first
    if (window.cartState) {
        await window.cartState.init();
    }

    // Initialize global wishlist state
    if (window.globalState) {
        await window.globalState.init(serverWishlistIds);
        // Sync all wishlist buttons on page load
        window.globalState.syncAllWishlistButtons();
    }

    // Initialize all functionality
    loadFlashSales();
    loadNewArrivals();
    initializeCarousel();
    initializeSmoothScrolling();
    initializeScrollAnimations();
});

// ====== CAROUSEL FUNCTIONALITY ======
function initializeCarousel() {
    const slides = document.querySelectorAll('.carousel-slide');
    const indicators = document.querySelectorAll('.indicator');
    const carousel = document.getElementById('carousel');

    if (slides.length > 0 && indicators.length > 0) {
        let currentSlide = 0;

        function showSlide(index) {
            currentSlide = index;
            carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
            indicators.forEach((indicator, i) => {
                indicator.classList.toggle('active', i === currentSlide);
            });
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        }

        // Auto-play carousel
        setInterval(nextSlide, 5000);

        // Indicator click handlers
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => showSlide(index));
        });
    }
}

// ====== PRODUCT LOADING FUNCTIONS ======
// Load Flash Sales (products with offers)
async function loadFlashSales() {
    try {
        const response = await fetch('/api/products?sortBy=newest&limit=8');
        const data = await response.json();

        document.getElementById('flashSalesLoading').style.display = 'none';

        if (data.success && data.products && data.products.length > 0) {
            //  Filter products with offers (checks hasOffer from backend)
            const flashSaleProducts = data.products.filter(product => 
                product.hasOffer
            );
            
            if (flashSaleProducts.length > 0) {
                displayProducts(flashSaleProducts.slice(0, 4), 'flashSalesGrid');
            } else {
                // If no products with offers, show regular products
                displayProducts(data.products.slice(0, 4), 'flashSalesGrid');
            }
        } else {
            document.getElementById('flashSalesEmpty').style.display = 'block';
        }
    } catch (error) {
        console.error('Error loading flash sales:', error);
        document.getElementById('flashSalesLoading').style.display = 'none';
        document.getElementById('flashSalesEmpty').style.display = 'block';
    }
}

// Load New Arrivals (latest products)
async function loadNewArrivals() {
    try {
        const response = await fetch('/api/products/featured?limit=8');
        const data = await response.json();

        document.getElementById('newArrivalsLoading').style.display = 'none';

        if (data.success && data.products && data.products.length > 0) {
            displayProducts(data.products.slice(0, 4), 'newArrivalsGrid');
        } else {
            document.getElementById('newArrivalsEmpty').style.display = 'block';
        }
    } catch (error) {
        console.error('Error loading new arrivals:', error);
        document.getElementById('newArrivalsLoading').style.display = 'none';
        document.getElementById('newArrivalsEmpty').style.display = 'block';
    }
}

//  Synchronize all wishlist icons for the same product
function synchronizeWishlistIcons(productId, isActive) {
    const icons = document.querySelectorAll(`button.wishlist-icon[data-product-id="${productId}"]`);
    icons.forEach(icon => {
        if (isActive) {
            icon.classList.add('active');
            icon.title = 'Remove from Wishlist';
            icon.innerHTML = '<i class="fas fa-heart text-danger"></i>';
        } else {
            icon.classList.remove('active');
            icon.title = 'Add to Wishlist';
            icon.innerHTML = '<i class="far fa-heart"></i>';
        }
    });
}

//  Display products with category offers
function displayProducts(products, containerId) {
    const container = document.getElementById(containerId);
    
    const productCards = products.map(product => {
        //  Uses finalPrice (with category offers) and hasOffer from backend
        const hasOffer = product.hasOffer;
        const finalPrice = product.finalPrice.toFixed(2);
        const offerPercentage = product.offerPercentage;

        //  Check if product is in wishlist using global state
        const isInWishlist = window.globalState.isInWishlist(product._id);

        return `
            <div class="col-6 col-md-3">
                <div class="product-card">
                    <div class="product-image-container">
                        <!--  Shows best offer percentage -->
                        ${hasOffer ? `<div class="product-badge">${offerPercentage}% OFF</div>` : ''}
                        
                        <!--  Added data-product-id attribute -->
                        <button class="wishlist-icon ${isInWishlist ? 'active' : ''}" 
                                data-product-id="${product._id}"
                                onclick="toggleWishlistFromHome('${product._id}', this)" 
                                title="${isInWishlist ? 'Remove from Wishlist' : 'Add to Wishlist'}">
                            <i class="${isInWishlist ? 'fas fa-heart text-danger' : 'far fa-heart'}"></i>
                        </button>
                        
                        <img src="/uploads/products/${product.mainImage}" 
                             class="product-image" 
                             alt="${product.productName}"
                             onerror="this.src='/assets/placeholder.jpg'"
                             onclick="viewProduct('${product._id}')">
                    </div>
                    <div class="product-info">
                        <div class="product-brand">${product.brand}</div>
                        <h5 class="product-title">${product.productName}</h5>
                        <div class="product-price">
                            <div class="price-section">
                                <!--  Shows final price with category offers -->
                                <span class="current-price">₹${finalPrice}</span>
                                ${hasOffer ? `<span class="original-price">₹${product.salePrice.toFixed(2)}</span>` : ''}
                            </div>
                            <button class="add-to-cart" 
                                    onclick="addToCart('${product._id}')"
                                    ${product.quantity === 0 ? 'disabled' : ''}
                                    title="Add to Cart">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }).join('');

    container.innerHTML = productCards;
    container.style.display = 'flex';

    // Add animation
    setTimeout(() => {
        container.classList.add('products-loaded');
    }, 100);
}

//  Wishlist function with proper toggle functionality
async function toggleWishlistFromHome(productId, btn) {
    // Disable all icons for this product during the request
    const allProductIcons = document.querySelectorAll(`button.wishlist-icon[data-product-id="${productId}"]`);
    allProductIcons.forEach(icon => icon.disabled = true);

    try {
        // Always use /wishlist/add endpoint - it handles toggle functionality automatically
        const res = await fetch('/wishlist/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId })
        });
        const out = await res.json();

        if (out.success) {
            // Update global wishlist state and sync all buttons across pages
            if (out.action === 'added') {
                window.globalState.addToWishlist(productId);
            } else if (out.action === 'removed') {
                window.globalState.removeFromWishlist(productId);
            }

            // Update navbar wishlist count
            if (typeof updateWishlistCount === 'function') {
                updateWishlistCount();
            }

            showToast(out.message || (out.action === 'added' ? 'Added to wishlist' : 'Removed from wishlist'), 'success');
        } else {
            showToast(out.message || 'Failed to update wishlist', 'error');
        }
    } catch (err) {
        console.error('Error toggling wishlist:', err);
        showToast('Please login first', 'error');
    } finally {
        // Re-enable all icons for this product
        allProductIcons.forEach(icon => icon.disabled = false);
    }
}

//  Legacy function for backward compatibility
async function addToWishlist(productId) {
    const wishlistBtn = document.querySelector(`[data-product-id="${productId}"]`);
    if (wishlistBtn) {
        toggleWishlistFromHome(productId, wishlistBtn);
    }
}

//  ADD TO CART FUNCTIONALITY
async function addToCart(productId) {
    const button = event.target.closest('.add-to-cart');
    const originalContent = button.innerHTML;
    
    try {
        // Show loading state
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        button.disabled = true;
        
        const response = await fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ productId, quantity: 1 })
        });

        const result = await response.json();

        if (result.success) {
            // Show success state
            button.innerHTML = '<i class="fas fa-check"></i>';
            button.style.backgroundColor = '#28a745';

            // Update cart counter using unified cart state system
            if (window.cartState) {
                window.cartState.updateCount();
            } else if (typeof updateCartCount === 'function') {
                updateCartCount();
            }

            setTimeout(() => {
                button.innerHTML = originalContent;
                button.style.backgroundColor = '';
                button.disabled = false;
            }, 1500);

            showToast('Added to cart successfully!', 'success');
        } else {
            button.innerHTML = originalContent;
            button.disabled = false;
            showToast(result.message || 'Failed to add to cart', 'error');
        }
    } catch (error) {
        console.error('Error adding to cart:', error);
        button.innerHTML = originalContent;
        button.disabled = false;
        showToast('Please login to add items to cart', 'error');
    }
}

//  UNIFIED CART COUNTER UPDATE FUNCTION 
function updateCartCounter(count) {
    // Use unified cart state system
    if (window.cartState) {
        window.cartState.updateCount(count);
    } else {
        // Fallback for legacy support
        const cartCounter = document.querySelector('#cartCount');
        if (cartCounter) {
            cartCounter.textContent = count || '0';
            cartCounter.style.display = count > 0 ? 'flex' : 'none';
        }

        // Also update navbar cart counters
        const cartCountElements = document.querySelectorAll('.cart-count');
        cartCountElements.forEach(elem => {
            elem.textContent = count || '0';
            elem.style.display = count > 0 ? 'flex' : 'none';
        });
    }
}

// ====== NAVIGATION FUNCTIONS ======
function toggleMenu() {
    const hamburger = document.querySelector('.hamburger');
    const navLinks = document.querySelector('.nav-links');
    if (hamburger) hamburger.classList.toggle('active');
    if (navLinks) navLinks.classList.toggle('active');
}

function initializeSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// ====== PRODUCT ACTIONS ======
function viewProduct(productId) {
    console.log('View product:', productId);
    window.location.href = `/product/${productId}`;
}

function viewAllProducts() {
    console.log('View all products');
    window.location.href = '/shopPage';
}

// ====== SCROLL ANIMATIONS ======
function initializeScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all product cards and feature cards
    document.querySelectorAll('.product-card, .feature-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.6s ease';
        observer.observe(card);
    });
}

//  IMPROVED TOAST FUNCTION
function showToast(message, type = 'info') {
    // Create toast container if it doesn't exist
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        `;
        document.body.appendChild(toastContainer);
    }

    // Create toast element
    const toast = document.createElement('div');
    toast.style.cssText = `
        background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-size: 14px;
        font-weight: 500;
        max-width: 350px;
        word-wrap: break-word;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    `;

    // Add icon
    const icon = document.createElement('i');
    icon.className = type === 'success' ? 'fas fa-check-circle' : 
                     type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle';
    toast.appendChild(icon);

    // Add message
    const messageSpan = document.createElement('span');
    messageSpan.textContent = message;
    toast.appendChild(messageSpan);

    toastContainer.appendChild(toast);

    // Animate in
    setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateX(0)';
    }, 10);

    // Auto remove
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, type === 'success' ? 3000 : 5000);
}

// ====== CSS ANIMATIONS ======
const style = document.createElement('style');
style.textContent = `
    .products-loaded .col-6 {
        animation: fadeInUp 0.6s ease forwards;
    }
    
    .products-loaded .col-6:nth-child(1) { animation-delay: 0.1s; }
    .products-loaded .col-6:nth-child(2) { animation-delay: 0.2s; }
    .products-loaded .col-6:nth-child(3) { animation-delay: 0.3s; }
    .products-loaded .col-6:nth-child(4) { animation-delay: 0.4s; }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
`;
document.head.appendChild(style);
</script>


</body>
</html>
